
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App Delivery – Meus Pedidos</title>
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="../static/style.css" />
  <script src="/static/js/nav.js" defer></script>
  <style>
    .order-list { background:#fff; border-radius:10px; padding:12px; box-shadow:0 1px 8px rgba(0,0,0,.06); }
    .order { border:1px solid #f3f4f6; border-radius:8px; padding:10px; margin-bottom:10px; }
    .order small { color:#6b7280; }
    .badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; color:#fff; }
    .b-all { background:#6b7280; }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand" style="color:#ff3d3d">Área do Cliente</div>
      <nav>
        <a href="#" onclick="history.back();return false;">Voltar</a>
        <a href="/perfil">Perfil</a>
        <hr />
        <a href="/Templates/pedidos.html">Meus Pedidos</a>
        <a href="/logout">Sair</a>
      </nav>
    </aside>
    <main class="content">
      <h1>Meus Pedidos</h1>
      <div class="order-list" id="lista-hist"></div>
    </main>
  </div>

  <script>
    let data = [];

    async function load(){
      const r = await fetch('/api/cliente/pedidos');
      if (!r.ok) throw new Error('falha');
      data = await r.json();
      render();
    }

    function orderEl(p){
      const div = document.createElement('div');
      div.className = 'order';
      const badgeClass = 'b-all';
      const itens = (p.itens||[]).map(i=>`${i.Qtd||i.q}x ${i.Nome||i.n}`).join(', ');
      div.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
          <strong>Pedido ${p.id}</strong>
          <span class="badge ${badgeClass}">Pedidos</span>
        </div>
        <small>${p.loja||'Restaurante'}</small><br/>
        <small>${itens}</small><br/>
        <div style="margin-top:6px;">Total: <strong>R$ ${p.total.toFixed(2).replace('.', ',')}</strong></div>
      `;
      return div;
    }

    function render(){
      const box = document.getElementById('lista-hist');
      if (!box) return;
      box.innerHTML = '';
      if (!Array.isArray(data) || data.length === 0) {
        box.innerHTML = '<div style="color:#6b7280">Nenhum pedido.</div>';
        return;
      }
      // opcional: ordenar por ID desc se for numérico
      const sorted = [...data].sort((a,b)=> String(b.id).localeCompare(String(a.id)));
      sorted.forEach(p => box.appendChild(orderEl(p)));
    }

    window.addEventListener('load', () => { load(); });
  </script>
</body>
</html>
